<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Work Manager Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<!-- PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{font-family:Arial;background:#f4f6f8;margin:0;padding:20px}
.card{background:#fff;padding:20px;border-radius:10px;margin-bottom:15px;box-shadow:0 4px 10px rgba(0,0,0,.1)}
input,select,textarea,button{width:100%;padding:10px;margin-top:5px;margin-bottom:10px}
button{background:#1976d2;color:#fff;border:none;border-radius:6px;cursor:pointer}
button.secondary{background:#4caf50}
button.danger{background:#e53935}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:6px;text-align:center;font-size:13px}
.hidden{display:none}
.topbar{display:flex;justify-content:space-between;align-items:center}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginCard" class="card">
<h2>Work Manager Login</h2>
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<button onclick="login()">Unlock</button>
</div>

<!-- APP -->
<div id="app" class="hidden">

<div class="topbar">
<h2>Work Manager Pro</h2>
<div>
<button class="secondary" onclick="exportPDF()">Export PDF</button>
<button onclick="shareData()">Share</button>
<button class="danger" onclick="logout()">Logout</button>
</div>
</div>

<!-- FORM -->
<div class="card">
<h3>Add Entry</h3>

<input id="date" type="date">
<input id="customer" placeholder="Customer Name">
<input id="company" placeholder="Company Name">
<input id="location" placeholder="Location">

<select id="payment">
<option value="Pending">Pending</option>
<option value="Received">Received</option>
<option value="Partial">Partial</option>
</select>

<input id="amount" type="number" placeholder="Total Amount">
<textarea id="comment" placeholder="Comment"></textarea>

<button onclick="saveEntry()">Save Entry</button>
</div>

<!-- FILTER -->
<div class="card">
<h3>Filter</h3>

<select id="filterType" onchange="applyFilter()">
<option value="all">All</option>
<option value="month">Month</option>
<option value="company">Company</option>
<option value="payment">Payment Status</option>
</select>

<input id="filterValue" placeholder="Enter filter value">
<button onclick="applyFilter()">Apply Filter</button>
<button onclick="loadData()">Clear</button>
</div>

<!-- TABLE -->
<div class="card">
<h3>Records</h3>
<table>
<thead>
<tr>
<th>Date</th><th>Customer</th><th>Company</th><th>Location</th>
<th>Payment</th><th>Amount</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>
</div>

</div>

<script>
// ðŸ”¥ FIREBASE CONFIG (PUT YOUR REAL KEYS)
firebase.initializeApp({
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID"
});
const db = firebase.firestore();

// LOGIN (simple local demo)
function login(){
  document.getElementById("loginCard").classList.add("hidden");
  document.getElementById("app").classList.remove("hidden");
  loadData();
}

function logout(){
  document.getElementById("app").classList.add("hidden");
  document.getElementById("loginCard").classList.remove("hidden");
}

// SAVE ENTRY (SAFE)
function saveEntry(){
  const data = {
    date: document.getElementById("date").value || "",
    customer: document.getElementById("customer").value || "",
    company: document.getElementById("company").value || "",
    location: document.getElementById("location").value || "",
    payment: document.getElementById("payment").value || "Pending",
    amount: Number(document.getElementById("amount").value || 0),
    comment: document.getElementById("comment").value || "",
    status: "completed",          // ðŸ”’ NEVER undefined
    created: firebase.firestore.FieldValue.serverTimestamp()
  };

  db.collection("records").add(data)
  .then(()=>{ alert("Saved"); loadData(); })
  .catch(e=>alert(e.message));
}

// LOAD DATA
let allData=[];
function loadData(){
  db.collection("records").orderBy("created","desc").get().then(snap=>{
    allData = snap.docs.map(d=>d.data());
    render(allData);
  });
}

// FILTER
function applyFilter(){
  const type=document.getElementById("filterType").value;
  const val=document.getElementById("filterValue").value.toLowerCase();

  let filtered=allData;
  if(type==="month"){
    filtered=allData.filter(d=>d.date.startsWith(val));
  }
  if(type==="company"){
    filtered=allData.filter(d=>d.company.toLowerCase().includes(val));
  }
  if(type==="payment"){
    filtered=allData.filter(d=>d.payment.toLowerCase()===val);
  }
  render(filtered);
}

// RENDER TABLE
function render(data){
  const body=document.getElementById("tableBody");
  body.innerHTML="";
  data.forEach(d=>{
    body.innerHTML+=`
    <tr>
      <td>${d.date}</td>
      <td>${d.customer}</td>
      <td>${d.company}</td>
      <td>${d.location}</td>
      <td>${d.payment}</td>
      <td>â‚¹${d.amount}</td>
    </tr>`;
  });
}

// EXPORT PDF
function exportPDF(){
  const { jsPDF } = window.jspdf;
  const pdf=new jsPDF();
  let y=10;
  allData.forEach((d,i)=>{
    pdf.text(`${i+1}. ${d.date} | ${d.customer} | ${d.company} | â‚¹${d.amount}`,10,y);
    y+=8;
  });
  pdf.save("work-manager.pdf");
}

// SHARE
function shareData(){
  const text=allData.map(d=>`${d.date} ${d.customer} â‚¹${d.amount}`).join("\n");
  if(navigator.share){
    navigator.share({title:"Work Manager",text});
  }else{
    window.open(`https://wa.me/?text=${encodeURIComponent(text)}`);
  }
}
</script>

</body>
</html>
