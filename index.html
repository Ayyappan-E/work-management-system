<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Job Entry CRUD</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
:root{
  --box:#fff;
  --text:#000;
}
.dark{
  --box:#1e1e1e;
  --text:#fff;
}
body{
  margin:0;
  min-height:100vh;
  font-family:Arial;
  background:linear-gradient(135deg,#667eea,#764ba2,#6ee7b7);
  background-size:400% 400%;
  animation:bg 10s infinite;
  color:var(--text);
}
@keyframes bg{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}
.container{
  max-width:1100px;
  margin:20px auto;
  background:var(--box);
  border-radius:14px;
  padding:15px;
  box-shadow:0 15px 30px rgba(0,0,0,.25);
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:10px;
}
label{font-size:13px;font-weight:bold;}
input,select,textarea,button{
  width:100%;
  padding:7px;
  border-radius:6px;
  border:1px solid #aaa;
}
button{
  background:#4f46e5;
  color:white;
  border:none;
  cursor:pointer;
}
button.danger{background:#dc2626}
button.secondary{background:#059669}
.topbar{
  display:flex;
  gap:10px;
  justify-content:space-between;
  flex-wrap:wrap;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  border:1px solid #ccc;
  padding:6px;
  font-size:12px;
}
</style>
</head>

<body>

<div class="container" id="reportBox">

<div class="topbar">
  <div>
    <button onclick="toggleDark()">üåô Dark</button>
    <button onclick="exportPDF()">üìÑ PDF</button>
    <button onclick="shareReport()">üì§ Share</button>
  </div>
</div>

<h3>Job Entry</h3>

<input type="hidden" id="docId">

<div class="grid">
<label>Date<input type="date" id="date"></label>
<label>QN<input id="qn"></label>
<label>Customer<input id="customer"></label>
<label>Location<input id="location"></label>
<label>Win Qty<input type="number" id="qty"></label>
<label>Total Sqft<input type="number" id="sqft"></label>
<label>Extra Payment<input type="number" id="extra"></label>
<label>Total Amount<input type="number" id="total"></label>
<label>Helpers<input type="number" id="helpers"></label>
<label>OT<input type="number" id="ot"></label>
<label>Company<input id="company"></label>

<label>Status
<select id="status">
<option>Completed</option>
<option>Pending</option>
</select>
</label>

<label>Payment
<select id="payment">
<option>Paid</option>
<option>Unpaid</option>
</select>
</label>

<label>Balance<input type="number" id="balance"></label>

<label>Job Type
<select id="jobtype">
<option>Solo</option>
<option>Partner</option>
</select>
</label>

<label>Holiday?
<select id="holiday">
<option>No</option>
<option>Yes</option>
</select>
</label>

<label>Holiday Reason
<textarea id="comment"></textarea>
</label>
</div>

<br>
<button onclick="saveData()">üíæ Save</button>
<button class="secondary" onclick="updateData()">‚úèÔ∏è Update</button>

<hr>

<h3>Report</h3>
<table>
<thead>
<tr>
<th>Date</th><th>QN</th><th>Customer</th><th>Company</th>
<th>Job</th><th>Total</th><th>Balance</th><th>Action</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyCcdPfK_Y4sUb2O0jqT2-6O3iN1R2_jG58",
  authDomain: "ayyappan-work-management.firebaseapp.com",
  projectId: "ayyappan-work-management"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

function toggleDark(){
  document.body.classList.toggle("dark");
}

/* CREATE */
function saveData(){
  db.collection("jobs").add(getFormData())
    .then(()=>{alert("Saved");clearForm();});
}

/* READ */
db.collection("jobs").onSnapshot(snap=>{
  tbody.innerHTML="";
  snap.forEach(doc=>{
    let d=doc.data();
    tbody.innerHTML+=`
    <tr>
      <td>${d.date}</td>
      <td>${d.qn}</td>
      <td>${d.customer}</td>
      <td>${d.company}</td>
      <td>${d.jobtype}</td>
      <td>${d.total}</td>
      <td>${d.balance}</td>
      <td>
        <button onclick="editData('${doc.id}',${JSON.stringify(d).replace(/"/g,'&quot;')})">Edit</button>
        <button class="danger" onclick="deleteData('${doc.id}')">Del</button>
      </td>
    </tr>`;
  });
});

/* LOAD TO FORM */
function editData(id,d){
  docId.value=id;
  for(let k in d){
    if(document.getElementById(k))
      document.getElementById(k).value=d[k];
  }
  window.scrollTo({top:0,behavior:"smooth"});
}

/* UPDATE */
function updateData(){
  if(!docId.value){alert("Select record");return;}
  db.collection("jobs").doc(docId.value)
    .update(getFormData())
    .then(()=>{alert("Updated");clearForm();});
}

/* DELETE */
function deleteData(id){
  if(confirm("Delete record?")){
    db.collection("jobs").doc(id).delete();
  }
}

/* HELPERS */
function getFormData(){
  return {
    date:date.value||"",
    qn:qn.value||"",
    customer:customer.value||"",
    location:location.value||"",
    qty:Number(qty.value)||0,
    sqft:Number(sqft.value)||0,
    extra:Number(extra.value)||0,
    total:Number(total.value)||0,
    helpers:Number(helpers.value)||0,
    ot:Number(ot.value)||0,
    company:company.value||"",
    status:status.value||"",
    payment:payment.value||"",
    balance:Number(balance.value)||0,
    jobtype:jobtype.value||"",
    holiday:holiday.value||"No",
    comment:comment.value||""
  };
}

function clearForm(){
  document.querySelectorAll("input,textarea").forEach(i=>i.value="");
  docId.value="";
}

function exportPDF(){
  html2pdf().from(reportBox).save("Job_Report.pdf");
}

function shareReport(){
  if(navigator.share){
    navigator.share({
      title:"Job Report",
      text:"Job report",
      url:location.href
    });
  }else{
    alert("Share not supported");
  }
}
</script>

</body>
</html>
