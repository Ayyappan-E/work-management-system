<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Work Manager</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
}

.container {
  max-width: 900px;
  margin: auto;
  padding: 16px;
}

.card {
  background: #fff;
  border-radius: 14px;
  padding: 16px;
  margin-bottom: 16px;
}

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit,minmax(200px,1fr));
  gap: 12px;
}

label {
  font-size: 13px;
  font-weight: bold;
}

input, select {
  width: 100%;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
}

button {
  padding: 12px 20px;
  border-radius: 10px;
  border: none;
  background: #4f46e5;
  color: #fff;
  font-weight: bold;
  cursor: pointer;
  position: relative;
  z-index: 10;
}

button:disabled {
  opacity: 0.6;
}

.helpers-row {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 10px;
  margin-bottom: 8px;
}
</style>
</head>

<body>

<div class="container">

<div class="card">
<h3>Add Work</h3>

<div class="grid">
  <div>
    <label>Date</label>
    <input type="date" id="date">
  </div>

  <div>
    <label>Customer</label>
    <input id="customer">
  </div>

  <div>
    <label>Location</label>
    <input id="location">
  </div>

  <div>
    <label>Company</label>
    <input id="company">
  </div>

  <div>
    <label>Work Type</label>
    <select id="partner">
      <option value="Solo">Solo</option>
      <option value="Partnership">Partnership</option>
    </select>
  </div>

  <div>
    <label>Window Qty</label>
    <input type="number" id="qty">
  </div>

  <div>
    <label>Sqft / Window</label>
    <input type="number" id="sqft">
  </div>

  <div>
    <label>Rate / Sqft</label>
    <input type="number" id="rate">
  </div>

  <div>
    <label>Payment Status</label>
    <select id="payment">
      <option>Pending</option>
      <option>Partial</option>
      <option>Received</option>
    </select>
  </div>
</div>

<br>

<h4>Helpers</h4>
<div id="helpers"></div>

<button type="button" onclick="addHelper()">+ Add Helper</button>
<br><br>

<button id="saveBtn" type="button" onclick="saveWork()">Save Work</button>

</div>

<div class="card" id="records">
<h3>Work Records</h3>
</div>

</div>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyCcdPfK_Y4sUb2O0jqT2-6O3iN1R2_jG58",
  authDomain: "ayyappan-work-management.firebaseapp.com",
  projectId: "ayyappan-work-management"
});

const db = firebase.firestore();

function addHelper() {
  helpers.innerHTML += `
    <div class="helpers-row">
      <input placeholder="Helper Name">
      <input type="number" placeholder="Salary">
      <input type="number" placeholder="Petrol">
    </div>
  `;
}

function saveWork() {
  const btn = document.getElementById("saveBtn");
  btn.disabled = true;
  btn.innerText = "Saving...";

  const helpersArr = [...helpers.children].map(row => ({
    name: row.children[0].value,
    salary: +row.children[1].value || 0,
    petrol: +row.children[2].value || 0
  }));

  const data = {
    date: date.value,
    customer: customer.value,
    location: location.value,
    company: company.value,
    partner: partner.value,
    qty: +qty.value || 0,
    sqft: +sqft.value || 0,
    rate: +rate.value || 0,
    payment: payment.value,
    helpers: helpersArr,
    created: new Date()
  };

  db.collection("works").add(data)
    .then(() => {
      alert("✅ Work saved successfully");
      document.querySelectorAll("input").forEach(i => i.value = "");
      helpers.innerHTML = "";
      btn.disabled = false;
      btn.innerText = "Save Work";
    })
    .catch(err => {
      alert("❌ Error: " + err.message);
      btn.disabled = false;
      btn.innerText = "Save Work";
    });
}

db.collection("works").orderBy("created","desc")
.onSnapshot(snap => {
  records.innerHTML = "<h3>Work Records</h3>";
  snap.forEach(doc => {
    const d = doc.data();
    records.innerHTML += `
      <p><b>${d.customer}</b> - ${d.location} - ₹${d.qty * d.sqft * d.rate}</p>
    `;
  });
});
</script>

</body>
</html>
