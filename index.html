<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pro Work Manager</title>  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/feather-icons"></script>  <!-- Firebase -->  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>  <!-- PDF -->  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>  <style>
    :root{
      --accent:#4f46e5; --card:#fff; --text:#111827;
    }
    body.dark{--card:#0f172a;--text:#e5e7eb;background:#020617;}
    body{margin:0;font-family:Inter;background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);color:var(--text)}
    header{display:flex;justify-content:space-between;align-items:center;padding:16px;color:#fff}
    .container{max-width:1200px;margin:auto;padding:16px}
    .card{background:var(--card);border-radius:16px;padding:16px;margin-bottom:16px;box-shadow:0 10px 25px rgba(0,0,0,.15);animation:fade .4s}
    @keyframes fade{from{opacity:0;transform:translateY(15px)}to{opacity:1}}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px}
    input,select{padding:10px;border-radius:10px;border:1px solid #ccc}
    button{background:var(--accent);color:#fff;border:none;padding:10px 16px;border-radius:12px;font-weight:600;cursor:pointer}
    button.gray{background:#6b7280}
    .hidden{display:none}
    .expand{cursor:pointer;color:var(--accent);font-weight:600}
    footer{text-align:center;color:#fff;padding:20px}
  </style></head>
<body>
<header>
  <h2>üèóÔ∏è PRO WORK MANAGER</h2>
  <div onclick="document.body.classList.toggle('dark')">üåô</div>
</header><div class="container" id="app"><!-- FILTERS --><div class="card">
  <h3>Filters</h3>
  <div class="grid">
    <input type="month" id="fMonth">
    <input placeholder="Company" id="fCompany">
    <input placeholder="Location" id="fLocation">
    <select id="fPartner"><option value="">All</option><option value="Solo">Solo</option><option value="Partnership">Partnership</option></select>
  </div><br>
  <button onclick="loadWorks()">Apply Filter</button>
  <button class="gray" onclick="exportPDF()">Export PDF</button>
</div><!-- ADD WORK --><div class="card">
  <h3>Add / Update Work</h3>
  <div class="grid">
    <input type="date" id="date">
    <input placeholder="Customer" id="customer">
    <input placeholder="Location" id="location">
    <input placeholder="Company" id="company">
    <select id="partner"><option value="Solo">Solo</option><option value="Partnership">Partnership</option></select>
    <input type="number" placeholder="Window Qty" id="qty">
    <input type="number" placeholder="Sqft / Window" id="sqft">
    <input type="number" placeholder="Rate / Sqft" id="rate">
  </div><br>  <h4>Helpers</h4>
  <div id="helpers"></div>
  <button class="gray" onclick="addHelper()">+ Add Helper</button><br><br>  <select id="payment">
    <option>Pending</option><option>Partial</option><option>Received</option>
  </select><br><br><button onclick="saveWork()">Save Work</button>

</div><!-- SUMMARY --><div class="card" id="summary"></div><!-- WORK RECORDS AT BOTTOM --><div class="card" id="list"><h3>Work Records</h3></div>
</div><footer>¬© Pro Work Manager</footer><script>
feather.replace();

firebase.initializeApp({
apiKey:"AIzaSyCcdPfK_Y4sUb2O0jqT2-6O3iN1R2_jG58",
 authDomain:"ayyappan-work-management.firebaseapp.com",
 projectId:"ayyappan-work-management"});
const db=firebase.firestore();
let editId=null;

function addHelper(name='',salary='',petrol=''){
  helpers.innerHTML+=`<div class='grid'>
    <input placeholder='Helper Name' value='${name}'>
    <input type='number' placeholder='Salary' value='${salary}'>
    <input type='number' placeholder='Petrol' value='${petrol}'>
  </div>`;
}

function saveWork(){
  const h=[...helpers.children].map(row=>({
    name:row.children[0].value,
    salary:+row.children[1].value,
    petrol:+row.children[2].value
  }));

  const data={
    date:date.value,customer:customer.value,location:location.value,
    company:company.value,partner:partner.value,
    qty:+qty.value,sqft:+sqft.value,rate:+rate.value,
    helpers:h,payment:payment.value,created:new Date()
  };

  editId?db.collection('works').doc(editId).set(data):db.collection('works').add(data);
  editId=null;helpers.innerHTML='';
}

function loadWorks(){
  list.innerHTML='<h3>Work Records</h3>'; let total=0;
  db.collection('works').onSnapshot(snap=>{(snap=>{
    snap.forEach(doc=>{
      const fP=fPartner.value;
      if(fP && doc.data().partner!==fP) return;
      const d=doc.data();
      const sqft=d.qty*d.sqft; const amt=sqft*d.rate;
      const helperCost=d.helpers.reduce((s,h)=>s+h.salary+h.petrol,0);
      const profit=amt-helperCost; total+=profit;

      list.innerHTML+=`<div class='card'>
        <div class='expand' onclick='this.nextElementSibling.classList.toggle("hidden")'>+ ${d.customer} (${d.date})</div>
        <div class='hidden'>
          <p>${d.location} | ${d.company}</p>
          <p>Amount: ‚Çπ${amt}</p>
          <p>Helpers Cost: ‚Çπ${helperCost}</p>
          <p><b>Profit: ‚Çπ${profit}</b></p>
          <button class='gray' onclick='editWork("${doc.id}")'>Edit</button>
          <button class='gray' onclick='db.collection("works").doc("${doc.id}").delete()'>Delete</button>
        </div></div>`;
    });
    document.getElementById('summary').innerHTML=`This month profit ‚Çπ${total} ${total>75000?'üî• Outstanding!':'üí™ Keep growing!'}`;
  });
}

function editWork(id){
  db.collection('works').doc(id).get().then(doc=>{
    const d=doc.data(); editId=id;
    date.value=d.date;customer.value=d.customer;location.value=d.location;
    company.value=d.company;partner.value=d.partner;qty.value=d.qty;
    sqft.value=d.sqft;rate.value=d.rate;payment.value=d.payment;
    helpers.innerHTML=''; d.helpers.forEach(h=>addHelper(h.name,h.salary,h.petrol));
  });
}

function exportPDF(){html2pdf().from(document.getElementById('list')).save('work-report.pdf')}

loadWorks();
</script></body>
</html>          <p>${d.location} | ${d.company}</p>
          <p>Amount: ‚Çπ${amt}</p>
          <p>Helpers Cost: ‚Çπ${helperCost}</p>
          <p><b>Profit: ‚Çπ${profit}</b></p>
          <button class='gray' onclick='editWork("${doc.id}")'>Edit</button>
          <button class='gray' onclick='db.collection("works").doc("${doc.id}").delete()'>Delete</button>
        </div></div>`;
    });
    summary.innerHTML=`This month profit ‚Çπ${total} ${total>75000?'üî• Outstanding!':'üí™ Keep growing!'}`;
  });
}

function editWork(id){
  db.collection('works').doc(id).get().then(doc=>{
    const d=doc.data(); editId=id;
    date.value=d.date;customer.value=d.customer;location.value=d.location;
    company.value=d.company;partner.value=d.partner;qty.value=d.qty;
    sqft.value=d.sqft;rate.value=d.rate;payment.value=d.payment;
    helpers.innerHTML=''; d.helpers.forEach(h=>addHelper(h.name,h.salary,h.petrol));
  });
}

function exportPDF(){html2pdf().from(document.getElementById('list')).save('work-report.pdf')}

loadWorks();
</script></body>
</html>
