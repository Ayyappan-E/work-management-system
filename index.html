<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Job Entry</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- PDF Export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
:root {
  --bg:#f2f2f2;
  --box:#fff;
  --text:#000;
}
.dark {
  --bg:#121212;
  --box:#1e1e1e;
  --text:#fff;
}
body {
  background:var(--bg);
  color:var(--text);
  font-family:Arial;
}
.container {
  max-width:1100px;
  margin:20px auto;
  background:var(--box);
  border:2px solid #777;
  border-radius:10px;
  padding:15px;
}
.grid {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:10px;
}
label { font-size:13px; }
input, select, textarea, button {
  width:100%;
  padding:6px;
}
table {
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th, td {
  border:1px solid #999;
  padding:6px;
  font-size:12px;
}
.topbar {
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  justify-content:space-between;
}
button {
  cursor:pointer;
}
</style>
</head>

<body>

<div class="container" id="reportBox">

<div class="topbar">
  <button type="button" onclick="toggleDark()">ðŸŒ™ Dark</button>
  <button type="button" onclick="exportPDF()">ðŸ“„ PDF</button>
</div>

<h3>Job Entry Form</h3>

<!-- â— NO <form> TAG (fixes save issue) -->
<div class="grid">

<label>Date<input type="date" id="date"></label>
<label>QN<input id="qn"></label>
<label>Customer Name<input id="customer"></label>
<label>Location<input id="location"></label>
<label>Win Qty<input type="number" id="qty"></label>
<label>Total Sqft<input type="number" id="sqft"></label>
<label>Extra Payment<input type="number" id="extra"></label>
<label>Total Amount<input type="number" id="total"></label>
<label>Helpers<input type="number" id="helpers"></label>
<label>OT<input type="number" id="ot"></label>
<label>Company Name<input id="company"></label>

<label>Status
<select id="status">
<option value="">Select</option>
<option>Completed</option>
<option>Pending</option>
</select>
</label>

<label>Payment Status
<select id="payment">
<option value="">Select</option>
<option>Paid</option>
<option>Unpaid</option>
</select>
</label>

<label>Balance<input type="number" id="balance"></label>

<label>Job Type
<select id="jobtype">
<option>Solo</option>
<option>Partner</option>
</select>
</label>

<label>Today Holiday?
<select id="holiday">
<option>No</option>
<option>Yes</option>
</select>
</label>

<label>Holiday Reason
<textarea id="comment"></textarea>
</label>

</div>

<br>
<button type="button" onclick="saveData()">ðŸ’¾ Save</button>

<hr>

<h3>Filters</h3>
<div class="grid">
<select id="filterJob" onchange="loadData()">
<option value="">All Job Types</option>
<option>Solo</option>
<option>Partner</option>
</select>

<input id="filterCompany" placeholder="Company filter" onkeyup="loadData()">
<input type="month" id="filterMonth" onchange="loadData()">
</div>

<h3>Report</h3>
<table>
<thead>
<tr>
<th>Date</th><th>QN</th><th>Customer</th><th>Company</th>
<th>Job</th><th>Total</th><th>Balance</th><th>Holiday</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
/* ðŸ”´ REPLACE WITH YOUR CONFIG */
const firebaseConfig = {
    apiKey: "AIzaSyCcdPfK_Y4sUb2O0jqT2-6O3iN1R2_jG58",
  authDomain: "ayyappan-work-management.firebaseapp.com",
  projectId: "ayyappan-work-management"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* DARK MODE */
function toggleDark() {
  document.body.classList.toggle("dark");
}

/* SAVE DATA â€” FIXED */
function saveData() {
  alert("Save clicked"); // confirms button works

  db.collection("jobs").add({
    date: date.value || "",
    qn: qn.value || "",
    customer: customer.value || "",
    location: location.value || "",
    qty: Number(qty.value) || 0,
    sqft: Number(sqft.value) || 0,
    extra: Number(extra.value) || 0,
    total: Number(total.value) || 0,
    helpers: Number(helpers.value) || 0,
    ot: Number(ot.value) || 0,
    company: company.value || "",
    status: status.value || "",
    payment: payment.value || "",
    balance: Number(balance.value) || 0,
    jobtype: jobtype.value || "",
    holiday: holiday.value || "No",
    comment: comment.value || ""
  })
  .then(() => {
    alert("Saved to Firebase");
    loadData();
  })
  .catch(err => alert(err.message));
}

/* LOAD + FILTER DATA */
function loadData() {
  tbody.innerHTML = "";
  db.collection("jobs").onSnapshot(snap => {
    snap.forEach(doc => {
      let d = doc.data();

      if (filterJob.value && d.jobtype !== filterJob.value) return;
      if (filterCompany.value && !d.company.toLowerCase().includes(filterCompany.value.toLowerCase())) return;
      if (filterMonth.value && !d.date.startsWith(filterMonth.value)) return;

      tbody.innerHTML += `
        <tr>
          <td>${d.date}</td>
          <td>${d.qn}</td>
          <td>${d.customer}</td>
          <td>${d.company}</td>
          <td>${d.jobtype}</td>
          <td>${d.total}</td>
          <td>${d.balance}</td>
          <td>${d.holiday}</td>
        </tr>`;
    });
  });
}
loadData();

/* PDF EXPORT */
function exportPDF() {
  html2pdf().from(reportBox).save("Job_Report.pdf");
}
</script>

</body>
</html>
