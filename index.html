<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ayyappan Work Management</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
:root{--bg:#fff;--text:#000}
.dark{--bg:#111;--text:#fff}

body{
  margin:0;font-family:Arial;color:var(--text);
  background:#0f172a;min-height:100vh;
}
.mobile-bg{
  position:fixed;inset:0;
  background:linear-gradient(120deg,#6366f1,#22c55e,#ec4899);
  background-size:300% 300%;
  animation:bgMove 10s infinite alternate;
  z-index:-1;opacity:.25;
}
@keyframes bgMove{
  0%{background-position:0% 50%}
  100%{background-position:100% 50%}
}

.container{
  max-width:1100px;margin:20px auto;
  background:var(--bg);padding:16px;
  border-radius:16px;
  box-shadow:0 20px 40px rgba(0,0,0,.35);
}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px}
label{font-size:13px;font-weight:bold}
input,select,textarea,button{
  width:100%;padding:8px;border-radius:6px;border:1px solid #aaa
}
button{background:#4f46e5;color:#fff;border:none;cursor:pointer}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;padding:6px;font-size:12px;text-align:center}

.summary{
  border:2px solid #4f46e5;border-radius:12px;
  padding:14px;text-align:center
}
.motivation{font-weight:bold;color:#22c55e}
.hidden{display:none}
</style>
</head>

<body>
<div class="mobile-bg"></div>

<div class="container">

<h2>Ayyappan Work Management</h2>

<!-- ENTRY FORM -->
<div class="grid">
<label>Date<input type="date" id="date"></label>

<label>Holiday?
<select id="holiday" onchange="toggleHoliday()">
<option value="no">No</option>
<option value="yes">Yes</option>
</select>
</label>

<label class="holidayOnly hidden">
Holiday Reason
<textarea id="holidayReason"></textarea>
</label>

<label class="workOnly">Customer<input id="customer"></label>
<label class="workOnly">Company<input id="company"></label>
<label class="workOnly">Total Sqft<input type="number" id="sqft" oninput="calc()"></label>
<label class="workOnly">Sqft Rate<input type="number" id="rate" oninput="calc()"></label>
<label class="workOnly">Extra<input type="number" id="extra" oninput="calc()"></label>
<label class="workOnly">Total Amount<input type="number" id="total" readonly></label>
<label class="workOnly">Job Type
<select id="jobtype">
<option>Solo</option>
<option>Partner</option>
</select>
</label>
</div>

<br>
<button onclick="saveData()">Save</button>

<hr>

<!-- FILTERS -->
<h3>Filters</h3>
<div class="grid">
<label>Job Type
<select id="fJob" onchange="render()">
<option value="">All</option>
<option>Solo</option>
<option>Partner</option>
</select>
</label>
<label>Company<input id="fCompany" onkeyup="render()"></label>
<label>Month<input type="month" id="fMonth" onchange="render()"></label>
</div>

<!-- REPORT -->
<div id="reportBox">

<h3>Summary</h3>
<div class="summary">
<h2 id="sum">â‚¹0</h2>
<div id="msg" class="motivation">Letâ€™s start strong ðŸ’ª</div>
</div>

<h3>Report</h3>
<table>
<thead>
<tr>
<th>Date</th>
<th>Type</th>
<th>Customer</th>
<th>Company</th>
<th>Sqft</th>
<th>Rate</th>
<th>Total</th>
<th>Note</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

</div>

<br>
<button onclick="exportPDF()">Export PDF</button>
<button onclick="toggleDark()">Dark Mode</button>

</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyCcdPfK_Y4sUb2O0jqT2-6O3iN1R2_jG58",
  authDomain:"ayyappan-work-management.firebaseapp.com",
  projectId:"ayyappan-work-management"
});
const db=firebase.firestore();
let data=[];

/* HOLIDAY TOGGLE */
function toggleHoliday(){
  const h = holiday.value==="yes";
  document.querySelectorAll(".workOnly").forEach(e=>e.style.display=h?"none":"block");
  document.querySelector(".holidayOnly").classList.toggle("hidden",!h);
}

/* AUTO CALC */
function calc(){
  total.value =
    (Number(sqft.value)||0) *
    (Number(rate.value)||0) +
    (Number(extra.value)||0);
}

/* SAVE */
function saveData(){
  if(holiday.value==="yes"){
    if(!holidayReason.value.trim()) return alert("Enter holiday reason");
    db.collection("jobs").add({
      date:date.value,
      type:"Holiday",
      reason:holidayReason.value,
      total:0
    });
  }else{
    db.collection("jobs").add({
      date:date.value,
      type:"Work",
      customer:customer.value,
      company:company.value,
      sqft:Number(sqft.value)||0,
      rate:Number(rate.value)||0,
      extra:Number(extra.value)||0,
      total:Number(total.value)||0,
      jobtype:jobtype.value
    });
  }
}

/* LOAD */
db.collection("jobs").onSnapshot(s=>{
  data=[]; s.forEach(d=>data.push(d.data()));
  render();
});

/* RENDER */
function render(){
  tbody.innerHTML="";
  let sum=0;

  data.forEach(d=>{
    if(d.type==="Work"){
      if(fJob.value && d.jobtype!==fJob.value) return;
      if(fCompany.value && !d.company?.toLowerCase().includes(fCompany.value.toLowerCase())) return;
      if(fMonth.value && !d.date?.startsWith(fMonth.value)) return;
      sum+=Number(d.total)||0;
    }

    tbody.innerHTML+=`
    <tr>
      <td>${d.date||"-"}</td>
      <td>${d.type||"-"}</td>
      <td>${d.customer||"-"}</td>
      <td>${d.company||"-"}</td>
      <td>${d.type==="Holiday"?"-":(d.sqft??"-")}</td>
      <td>${d.type==="Holiday"?"-":(d.rate??"-")}</td>
      <td>${d.type==="Holiday"?"Holiday":(d.total??0)}</td>
      <td>${d.reason||""}</td>
    </tr>`;
  });

  sumEl.innerText="â‚¹"+sum.toLocaleString();
  msg.innerText =
    sum===0?"Letâ€™s start strong ðŸ’ª":
    sum<10000?"Good start ðŸŒ±":
    sum<50000?"Great progress ðŸ”¥":
    sum<100000?"Youâ€™re crushing it ðŸš€":"Elite level ðŸ’Ž";
}

/* PDF */
function exportPDF(){
  html2pdf().from(reportBox)
  .set({filename:"Filtered_Report.pdf",jsPDF:{orientation:"landscape"}})
  .save();
}

function toggleDark(){document.body.classList.toggle("dark")}
</script>

</body>
</html>
